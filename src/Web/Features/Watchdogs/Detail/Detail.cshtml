@page "{watchdogId}"
@using MrWatchdog.Core.Features.Account.Domain
@using MrWatchdog.Core.Resources
@using MrWatchdog.Web.Features.Shared
@using MrWatchdog.Web.Features.Shared.TagHelpers.Onboarding
@model DetailModel

@{
    var searchTermSuffix = $"{(!string.IsNullOrWhiteSpace(Model.WatchdogArgs.SearchTerm) ? $" - {Model.WatchdogArgs.SearchTerm}" : "")}";
    ViewData["Title"] = $"{Model.ScraperScrapedResultsArgs.ScraperName}{searchTermSuffix}";
}

@section Navigation {
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-page="/Index"><i class="fa-solid fa-house"></i></a>
            </li>
            <li class="breadcrumb-item">
                <a asp-page="/Watchdogs/Index">@Resource.MyWatchdogs</a>
            </li>
            <li class="breadcrumb-item active text-wrap text-break" aria-current="page">
                <span>@Model.ScraperScrapedResultsArgs.ScraperName</span>
                <span translate="no">@searchTermSuffix</span>
            </li>
        </ol>
    </nav>
    <onboarding id="@OnboardingElementIdentifiers.OnboardingId"
                identifier="@OnboardingIdentifiers.WatchdogDetail"
                steps="@([
                           new OnboardingStepStimulusModel(
                               Text: Resource.WatchdogOnboardingIntro
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.WatchdogOnboardingIntroScrapedResults,
                               ElementIdentifier: $"#{@OnboardingElementIdentifiers.ScrapersScrapedResultsWebPagesWatchedWebPagesId}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.WatchdogOnboardingIntroSearchTerm,
                               ElementIdentifier: $".{OnboardingElementIdentifiers.WatchdogsDetailSearchTermInputGroupCssClass}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.WatchdogOnboardingReceiveNotification,
                               ElementIdentifier: $".{OnboardingElementIdentifiers.WatchdogsDetailReceiveNotificationCssClass}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.OnboardingViewAgainStep,
                               ElementIdentifier: $"#{OnboardingElementIdentifiers.OnboardingId}"
                           )
                       ])"
    />
}

<div @Stimulus.Controller(StimulusControllers.WatchdogDetail, new WatchdogDetailStimulusModel(Resource.DeleteWatchdogConfirmationMessage))>
    
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="display-4 text-wrap text-break">
            <a asp-page="/Scrapers/ScrapedResults/ScrapedResults" 
               asp-route-scraperId="@Model.WatchdogArgs.ScraperId">
                @Model.ScraperScrapedResultsArgs.ScraperName
            </a>
            <span data-watchdogs--detail-target="searchTermSuffix" translate="no">@searchTermSuffix</span>
        </h1>
        @if (Model.WatchdogArgs.IsArchived)
        {
            <span class="badge text-bg-warning">
                @Resource.Archived
            </span>
        }
    </div>
    <div class="d-flex justify-content-between align-items-center">
        <div></div>
        <div>
            <div class="dropdown">
                <button
                    class="btn btn-sm"
                    type="button"
                    data-bs-toggle="dropdown"
                >
                    <i class="fa-solid fa-bars"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <form asp-page-handler="ArchiveWatchdog"
                              asp-route-watchdogId="@Model.WatchdogArgs.WatchdogId"
                              method="post"
                              data-watchdogs--detail-target="archiveWatchdogForm"
                        >
                            <button class="dropdown-item text-danger" 
                                    type="submit"
                            >
                                @Resource.DeleteWatchdog
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div>
        <div class="row">
            <div class="col-md-6">
                <turbo-frame id="watchdog_overview_@(Model.WatchdogArgs.WatchdogId)"
                             src="@Url.Page("Overview/Overview", new {Model.WatchdogArgs.WatchdogId})">
                </turbo-frame>
            </div>
        </div>

        <scraped-results-web-pages scraper-scraped-results-args="Model.ScraperScrapedResultsArgs" />
    </div>
</div>