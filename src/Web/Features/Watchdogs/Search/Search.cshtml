@page "{watchdogSearchId}"
@using MrWatchdog.Core.Features.Account.Domain
@using MrWatchdog.Core.Resources
@using MrWatchdog.Web.Features.Shared
@using MrWatchdog.Web.Features.Shared.TagHelpers.Onboarding
@model SearchModel

@{
    var searchTermSuffix = $"{(!string.IsNullOrWhiteSpace(Model.WatchdogSearchArgs.SearchTerm) ? $" - {Model.WatchdogSearchArgs.SearchTerm}" : "")}";
    ViewData["Title"] = $"{Model.WatchdogScrapingResultsArgs.WatchdogName}{searchTermSuffix}";
}

@section Navigation {
    <nav>
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a asp-page="/Index"><i class="fa-solid fa-house"></i></a>
            </li>
            <li class="breadcrumb-item">
                <a asp-page="/Watchdogs/Searches/Searches">@Resource.MySearches</a>
            </li>
            <li class="breadcrumb-item active text-wrap text-break" aria-current="page">
                <span>@Model.WatchdogScrapingResultsArgs.WatchdogName</span>
                <span translate="no">@searchTermSuffix</span>
            </li>
        </ol>
    </nav>
    <onboarding id="@OnboardingElementIdentifiers.OnboardingId"
                identifier="@OnboardingIdentifiers.WatchdogsSearch"
                steps="@([
                           new OnboardingStepStimulusModel(
                               Title: "Onboarding",
                               Text: "You navigated to your <b>watchdog search</b>.<br/><br/>This watchdog search emails you notifications about new watchdog search results."
                           ),
                           new OnboardingStepStimulusModel(
                               Text: "It periodically watches web page(s) and selects search results from them.",
                               ElementIdentifier: $"#{@OnboardingElementIdentifiers.WatchdogsScrapingResultsWebPagesWatchedWebPagesId}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: "You can enter a search term to filter the search results. When no results - or no results matching the search term " +
                                     "- are currently available, you will receive an email notification as soon as they are available.",
                               ElementIdentifier: $".{OnboardingElementIdentifiers.WatchdogsSearchSearchTermInputGroupCssClass}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.OnboardingWatchdogSearchReceiveNotificationStep,
                               ElementIdentifier: $".{OnboardingElementIdentifiers.WatchdogsSearchReceiveNotificationCssClass}"
                           ),
                           new OnboardingStepStimulusModel(
                               Text: Resource.OnboardingViewAgainStep,
                               ElementIdentifier: $"#{OnboardingElementIdentifiers.OnboardingId}"
                           )
                       ])"
    />
}

<div @Stimulus.Controller(StimulusControllers.WatchdogSearch)>
    
    <div class="d-flex justify-content-between align-items-center">
        <h1 class="display-4 text-wrap text-break">
            <a asp-page="/Watchdogs/ScrapingResults/ScrapingResults" 
               asp-route-watchdogId="@Model.WatchdogSearchArgs.WatchdogId">
                @Model.WatchdogScrapingResultsArgs.WatchdogName
            </a>
            <span data-watchdogs--search-target="searchTermSuffix" translate="no">@searchTermSuffix</span>
        </h1>
        @if (Model.WatchdogSearchArgs.IsArchived)
        {
            <span class="badge text-bg-warning">
                Archived
            </span>
        }
    </div>
    <div class="d-flex justify-content-between align-items-center">
        <div></div>
        <div>
            <div class="dropdown">
                <button
                    class="btn btn-sm"
                    type="button"
                    data-bs-toggle="dropdown"
                >
                    <i class="fa-solid fa-bars"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <form asp-page-handler="ArchiveWatchdogSearch"
                              asp-route-watchdogSearchId="@Model.WatchdogSearchArgs.WatchdogSearchId"
                              method="post"
                              data-watchdogs--search-target="archiveWatchdogSearchForm"
                        >
                            <button class="dropdown-item text-danger" 
                                    type="submit"
                            >
                                Delete watchdog search
                            </button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div>
        <div class="row">
            <div class="col-md-6">
                <turbo-frame id="watchdog_search_overview_@(Model.WatchdogSearchArgs.WatchdogSearchId)"
                             src="@Url.Page("Overview/Overview", new {Model.WatchdogSearchArgs.WatchdogSearchId})">
                </turbo-frame>
            </div>
        </div>

        <scraping-results-web-pages watchdog-scraping-results-args="Model.WatchdogScrapingResultsArgs" />
    </div>
</div>